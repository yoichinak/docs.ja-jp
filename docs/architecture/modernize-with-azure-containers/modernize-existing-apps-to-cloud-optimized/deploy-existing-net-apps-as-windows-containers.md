---
title: Windows コンテナーとして既存の .NET アプリを展開する
description: Azure クラウドおよび Windows コンテナーで既存の .NET アプリケーションを最新化する |既存の .NET アプリを Windows コンテナーとしてデプロイする
ms.date: 04/29/2018
ms.openlocfilehash: 997b32e51272be2126bd824de1f8f026d77ca203
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/15/2019
ms.locfileid: "72318640"
---
# <a name="deploy-existing-net-apps-as-windows-containers"></a>Windows コンテナーとして既存の .NET アプリを展開する

Windows コンテナーに基づく展開は、クラウド向けに最適化されたアプリケーションやクラウドネイティブのアプリケーションに適用できます。

ただし、このガイドと特に次のセクションでは、アプリケーションを再設計する必要のない、*クラウド向けに最適化*されたアプリケーションに Windows コンテナーを使用することに重点を置いています。

## <a name="what-are-containers-linux-or-windows"></a>コンテナーとは (Linux または Windows)

コンテナーは、アプリケーションを独自の分離パッケージにまとめる方法です。 コンテナーでは、コンテナーの外部に存在するアプリケーションやプロセスの影響を受けません。 プロセスがコンテナー内にあるため、アプリケーションが依存しているすべてのものが正常に実行されます。 コンテナーが移動される場合、アプリケーションの要件は、直接の依存関係の観点から常に満たされます。これは、実行する必要があるすべてのもの (ライブラリの依存関係、ランタイムなど) にバンドルされているためです。

コンテナーの主な特性は、コンテナー自体に必要なすべての依存関係が含まれているため、異なるデプロイで環境を同じにすることです。 コンピューターでアプリケーションをデバッグし、同じ環境が保証されている別のコンピューターに展開することができます。

コンテナーは、コンテナーイメージのインスタンスです。 コンテナーイメージは、(スナップショットのような) アプリまたはサービスをパッケージ化し、信頼性の高い再現可能な方法でデプロイする方法です。 Docker はテクノロジだけでなく、理念とプロセスでもあります。

1日に複数のコンテナーがより一般的になり、業界全体の "展開の単位" になりつつあります。

## <a name="benefits-of-containers-docker-engine-on-linux-or-windows"></a>コンテナーの利点 (Linux または Windows 上の Docker エンジン)

コンテナーを使用したアプリケーションの構築 (軽量な構成要素として定義されている場合もあります) は、インフラストラクチャ全体で任意のアプリケーションを構築、配布、実行するための機敏性を大幅に向上させます。

コンテナーを使用すると、Microsoft 開発者ツール、オペレーティングシステム、クラウド全体にわたる Docker 統合により、コードをほとんどまたはまったく変更せずに、開発から運用までのあらゆるアプリを利用できます。

Plain Vm にデプロイする場合、ASP.NET アプリを Vm にデプロイするための方法が既に用意されていることがあります。 ただし、方法には、パペットなどのデプロイツールまたは同様のツールを使用して、複数の手動手順または複雑な自動化プロセスが含まれている可能性があります。 場合によっては、構成項目の変更、サーバー間でのアプリケーションコンテンツのコピー、.msi セットアップに基づく対話型セットアッププログラムの実行、テストの実行などのタスクを実行する必要があります。 デプロイに含まれるすべての手順によって、展開にかかる時間とリスクが追加されます。 ターゲット環境に依存関係が存在しない場合は、エラーが発生します。

Windows コンテナーでは、アプリケーションをパッケージ化するプロセスは完全に自動化されています。 Windows コンテナーは、コンテナーデプロイの自動更新とロールバックを提供する Docker プラットフォームに基づいています。 Docker エンジンの使用によって得られる主な改善点は、アプリケーションのスナップショットのようなイメージを、すべての依存関係と共に作成することです。 イメージは、Docker イメージ (この場合は Windows コンテナーイメージ) です。 イメージは、ソースコードに戻ることなく、コンテナーで ASP.NET アプリを実行します。 コンテナーのスナップショットが配置の単位になります。

多くの組織は、次の理由で既存のモノリシックアプリケーションをコンテナー化しています。

- 強化された**デプロイによって機敏性が向上**します。 コンテナーは、開発と運用の間に一貫した配置コントラクトを提供します。 コンテナーを使用すると、開発者は、「私のコンピューターで動作し、運用環境では動作しないのはなぜですか。」と言うと、 「コンテナーとして実行され、運用環境で実行される」と言うことができます。 パッケージ化されたアプリケーションは、すべての依存関係と共に、サポートされている任意のコンテナーベースの環境で実行できます。 すべてのデプロイターゲット (dev、QA、ステージング、運用) での実行を意図した方法で実行されます。 コンテナーは、1つの段階から次の段階に移行するときにほとんどの frictions を排除します。これにより、展開が大幅に改善され、より迅速に出荷できるようになります。

- **コストの削減**。 コンテナーは、既存のハードウェアの統合と削除によって、またはハードウェアのユニットあたりの高密度でアプリケーションを実行することで、コストを削減します。

- **移植性**。 コンテナーはモジュール型で移植可能です。 Docker コンテナーは、任意のメジャーパブリッククラウド (Microsoft Azure、Amazon AWS、Google、IBM) の任意のサーバーオペレーティングシステム (Linux および Windows)、およびオンプレミスとプライベートまたはハイブリッドのクラウド環境でサポートされています。

- **コントロール**。 コンテナーは、コンテナーレベルで制御される柔軟で安全な環境を提供します。 コンテナーは、コンテナーに対して実行制約ポリシーを設定することによって、セキュリティ保護、分離、および制限することができます。 「Windows コンテナーについて」セクションで詳しく説明したように、Windows Server 2016 と Hyper-v コンテナーには、追加のエンタープライズサポートオプションが用意されています。

アプリケーションを開発および管理するためにコンテナーを使用すると、機敏性、移植性、および制御が大幅に改善され、最終的には大幅なコスト削減につながります。

## <a name="what-is-docker"></a>Docker について

[Docker](https://www.docker.com/)は、クラウドまたはオンプレミスで実行できる移植可能な自己完結型のコンテナーとしてアプリケーションのデプロイを自動化する[オープンソースプロジェクト](https://github.com/docker/docker)です。 Docker は、このテクノロジを促進および進化させる[会社](https://www.docker.com/)でもあります。 この会社は、Microsoft などのクラウド、Linux、および Windows ベンダーとの共同作業を行っています。

![Docker がハイブリッドクラウドでコンテナーを展開する方法を示す図。](./media/deploy-existing-net-apps-as-windows-containers/docker-deploys-containers-all-layers.png)

**図 4-6.** Docker は、ハイブリッド クラウドのすべてのレイヤーでコンテナーを展開します。

仮想マシンを使い慣れているユーザーにとって、コンテナーは非常に似ているように見えるかもしれません。 コンテナーは、オペレーティングシステムを実行し、ファイルシステムを備えています。また、物理または仮想コンピューターシステムと同様に、ネットワーク経由でアクセスすることもできます。 ただし、コンテナーの背後にあるテクノロジと概念は、仮想マシンとは大きく異なります。 開発者の観点から見ると、コンテナーは1つのプロセスと同様に扱う必要があります。 実際、コンテナーは1つのプロセスに対して1つのエントリポイントを持ちます。

Docker コンテナー (わかりやすくするために、*コンテナー*) は、Linux と Windows でネイティブに実行できます。 標準のコンテナーを実行する場合、Windows コンテナーは Windows ホスト (ホストサーバーまたは VM) 上でのみ実行でき、Linux コンテナーは Linux ホストでのみ実行できます。 ただし、最新バージョンの Windows Server と Hyper-v コンテナーでは、Linux コンテナーは、現在 Windows server のコンテナーでのみ使用できる Hyper-v 分離テクノロジを使用して、Windows Server 上でネイティブに実行することもできます。

近い将来、Linux と Windows の両方のコンテナーを持つ混合環境が可能であり、さらに一般的です。

## <a name="benefits-of-windows-containers-for-your-existing-net-applications"></a>既存の .NET アプリケーション用の Windows コンテナーの利点

Windows コンテナーを使用する利点は、一般にコンテナーから得られる利点と基本的に同じです。 Windows コンテナーを使用することは、機敏性、移植性、および制御を大幅に向上させることです。

既存の .NET アプリケーションは、.NET Framework を使用して作成されたアプリケーションを参照します。 たとえば、従来の ASP.NET web アプリケーションである場合があります。 .NET Core は使用されず、Linux、Windows、MacOS でクロスプラットフォームで実行されます。

.NET Framework の主な依存関係は Windows です。 また、IIS のようなセカンダリの依存関係と、従来の ASP.NET の System.web もあります。

.NET Framework アプリケーションは、Windows、ピリオドで実行する必要があります。 既存の .NET Framework アプリケーションをコンテナー化する場合に、.NET Core への移行に投資することはできないかどうか (「正常に動作している場合は移行しない」)、コンテナーの唯一の選択肢は Windows コンテナーを使用することです。

Windows コンテナーの主な利点の1つは、コンテナー化で実行されている既存の .NET Framework アプリケーションを最新化する方法を提供できることです。 最終的に、Windows コンテナーは、コンテナーを使用して求めているメリットを得ることができます。俊敏性、移植性、および制御が優れています。

## <a name="choose-an-os-to-target-with-net-based-containers"></a>対象の OS を選択します。NET ベースのコンテナー

Docker でサポートされているオペレーティングシステムの多様性と、.NET Framework と .NET Core の違いにより、使用しているフレームワークに基づいて特定の OS と特定のバージョンを対象にする必要があります。

Windows の場合、Windows Server Core または Windows Nano Server を使用できます。 これらの Windows バージョンには、.NET Framework または .NET Core アプリケーションで必要となる可能性があるさまざまな特性 (IIS と、Kestrel などの自己ホスト型 web サーバー) が用意されています。

Linux の場合、複数のディストリビューションを利用できます。また、Linux は公式の .NET Docker イメージ (Debian など) でサポートされています。

図4-7 に、アプリのバージョン .NET Framework に応じてターゲットにできる OS バージョンを示します。

![.NET Framework のバージョンに基づいてターゲットにする OS を示す図](./media/deploy-existing-net-apps-as-windows-containers/dotnet-framework-operating-systems.png)

**図 4-7.** .NET Framework のバージョンに基づいて対象とするオペレーティングシステム

.NET Framework アプリケーションに基づく既存またはレガシアプリケーションの移行シナリオでは、主な依存関係は Windows と IIS にあります。 唯一のオプションは、Windows Server Core と .NET Framework に基づく Docker イメージを使用することです。

イメージ名を Dockerfile ファイルに追加すると、次の例のように、タグを使用してオペレーティングシステムとバージョンを選択できます。 .NET Framework ベースの Windows コンテナーイメージについては、次の例をご覧ください。

> | **番号** | **システムとバージョン** |
> |---|---|
> | **microsoft/dotnet-framework:4.x-windowsservercore** | Windows Server Core での .NET Framework 4.x |
> | **microsoft/aspnet:4.x-windowsservercore** | Windows Server Core で ASP.NET カスタマイズが追加された .NET Framework 4.x |

.NET Core (Linux と Windows のクロスプラットフォーム) の場合、タグは次のようになります。

> | **番号** | **システムとバージョン**
> |---|---|
> | **microsoft/dotnet:2.0.0-runtime** | .NET Core 2.0 ランタイム-Linux 上のみ |
> | **microsoft/dotnet:2.0.0-runtime-nanoserver** | .NET Core 2.0 ランタイム-Windows Nano Server のみ |

### <a name="multi-arch-images"></a>マルチアーキテクチャイメージ

2017以降では、[マルチアーキテクチャ](https://github.com/moby/moby/issues/15866)イメージと呼ばれる Docker の新機能を使用することもできます。 .NET Core Docker イメージでは、マルチアーキテクチャタグを使用できます。 Dockerfile ファイルは、対象とするオペレーティングシステムを定義する必要がなくなりました。 マルチアーキテクチャ機能では、複数のコンピューター構成で1つのタグを使用できます。 たとえば、マルチアーキテクチャでは、 **microsoft/dotnet: 2.0.0**という1つの共通タグを使用できます。 Linux コンテナー環境からそのタグをプルすると、Debian ベースのイメージを取得できます。 このタグを Windows コンテナー環境からプルすると、Nano Server ベースのイメージが取得されます。

.NET Framework イメージの場合、従来の .NET Framework では Windows のみがサポートされるため、マルチアーキテクチャ機能は使用できません。

## <a name="windows-container-types"></a>Windows コンテナーの種類

Linux コンテナーと同様に、Windows Server コンテナーは Docker エンジンを使用して管理されます。 Linux コンテナーとは異なり、Windows コンテナーには、2つの異なるコンテナーの種類、または実行時-Windows Server のコンテナーと Hyper-v の分離が含まれています。

**Windows Server のコンテナー**:プロセスと名前空間の分離テクノロジを使用して、アプリケーションを分離します。 Windows Server コンテナーは、コンテナーホストとホストで実行されているすべてのコンテナーとカーネルを共有します。 これらのコンテナーは、悪意のあるセキュリティ境界を提供しないため、信頼されていないコードを分離するために使用しないでください。 これらのコンテナーには、共有されたカーネル空間があるため、同じカーネルバージョンと構成が必要です。

**Hyper-v の分離**:高度に最適化された VM で各コンテナーを実行することで、Windows Server コンテナーによって提供される分離を拡大します。 この構成では、コンテナーホストのカーネルは、同じホスト上の他のコンテナーとは共有されません。 これらのコンテナーは、VM と同じセキュリティ保証で、悪意のあるマルチテナントホスティング向けに設計されています。 これらのコンテナーは、ホスト上のホストまたはその他のコンテナーとカーネルを共有しないため、異なるバージョンと構成 (サポートされているバージョン) でカーネルを実行できます。 たとえば、windows 10 のすべての Windows コンテナーは、Windows Server カーネルのバージョンと構成を利用するために、Hyper-v の分離を使用します。

Hyper-v の分離を使用するかどうかに関係なく、Windows でコンテナーを実行することは、実行時の決定です。 最初に Hyper-v の分離を使用してコンテナーを作成し、実行時に Windows Server のコンテナーとして実行するように選択することもできます。

### <a name="additional-resources"></a>その他の技術情報

- **Windows コンテナーのドキュメント**

    <https://docs.microsoft.com/virtualization/windowscontainers/>

- **Windows コンテナーの基礎**

    <https://docs.microsoft.com/virtualization/windowscontainers/about/>

- **インフォグラフィック:Microsoft とコンテナー @ no__t-0

    <https://info.microsoft.com/rs/157-GQE-382/images/Container%20infographic%201.4.17.pdf>

## <a name="the-container-ecosystem-in-azure"></a>Azure のコンテナーエコシステム

前のセクションでは、Docker コンテナーの利点、および .NET アプリケーションの特定のコンテナーイメージの詳細について説明しました。 アプリケーションを開発したりコンテナー化したりするための一般的な情報はすべて基本的なものです。
ただし、運用環境のデプロイ環境や、QA および開発/テスト環境について考える場合、Microsoft Azure は、クラウドの完全なコンテナーエコシステムであるオープンで広範な選択肢を提供しています (以下の図を参照)。 アプリケーションのニーズに応じて、1つまたは別の Azure 製品を選択する必要があります。

![Azure のコンテナーエコシステムの図。](./media/deploy-existing-net-apps-as-windows-containers/azure-container-ecosystem.png)

**図 4-7.5。** Azure のコンテナーエコシステム

Azure のコンテナーエコシステムから、インフラストラクチャと見なされるコンテナーをサポートする次の製品があります。

- **Azure Container Instances (ACI)**
- **Azure Virtual Machines** (コンテナーのサポートあり)
- **Azure Virtual Machine Scale Sets** (コンテナーのサポートあり)

これら3つのうち、ACI には大きな利点があります。これは、基盤となる OS を維持する必要がなく、アップグレードやパッチなどを行う必要がないという事実ですが、このブックの今後のセクションで説明するように、ACI は引き続きインフラストラクチャレベルに配置されます。

Azure サポートコンテナーの製品は、PaaS (サービスとしてのプラットフォーム) レベルで同時に配置されます。

- **Azure App Service**
- **Azure Kubernetes サービス (AKS と ACS)**
- **Azure Batch** 

次に、Azure でホストされている拡張性の高いコンテナーレジストリを Azure Container Registry します。これは、カスタムコンテナーイメージを登録してデプロイするときに、以前のすべての製品から使用できます。

さらに、コンテナーから、Azure SQL Database、Azure Redis cache、Azure Cosmos DB など、Azure の他の管理されたサービスを利用することもできます。 また、Azure Marketplace には、Cloud Foundry や OpenShift などのサードパーティ製ソリューション/プラットフォームも用意されており、Azure 内でコンテナーを使用することもできます。 

次のセクションでは、Windows コンテナーを対象とする場合に、これらの各 Azure 製品とソリューションを使用するタイミングに関する Microsoft の推奨事項について説明します。

>[!div class="step-by-step"]
>[前へ](what-about-cloud-native-applications.md)
>[次へ](when-not-to-deploy-to-windows-containers.md)
